$.extend($.expr.pseudos, {
 
  'in-viewport': function(el,test,q) {
      /* тут будет наш код, и он будет решать, кто виноват */
      // return true || false; // выносим вердикт

    
      if(q[3] == undefined)
      {
        return elementInViewport2(el)
      }
      else 
      {
        return elementInViewport(el,q[3])
      }
     

     
  }
})

function elementInViewport2(el) {
  var top = el.offsetTop;
  var height = el.offsetHeight;

  while(el.offsetParent) {
    el = el.offsetParent;
    top += el.offsetTop;
  }

  return (
    top < (window.pageYOffset + window.innerHeight) &&
    (top + height) > window.pageYOffset 

  );
}


function elementInViewport(el,radius) {


  var top = el.offsetTop;
  var height = el.offsetHeight;

  while(el.offsetParent) {
    el = el.offsetParent;
    top += el.offsetTop;
  }

  return (
    top-radius < (window.pageYOffset + window.innerHeight) &&
    (top + height + radius) > window.pageYOffset 

  );
}


